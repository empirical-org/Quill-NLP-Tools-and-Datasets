# How to create synthetic data for the grammar model

General information about the grammar scripts can be found in the README file in the top directory. This README contains more information about our methods for creating synthetic data.

## General

Synthetic data can be generated with the script `create_grammar_training_corpus.py`.

```bash
> python scripts/quillgrammar/create_grammar_training_corpus.py <path_to_newsoftheworld_corpus>
```

The errors are created by taking sentences from US sources in the news of the world corpus, and injecting grammar errors into these sentences. By default, this injection is done with a probability of 50%. This means that:

- We take an initial set of sentences from the News of the World corpus.
- An error generator determines if a sentence is relevant for a particular error (e.g. it contains a commonly confused word) and injects an error by replacing the original word with an alternative word or word form.
- Of all these relevant sentences, 50% are written to the output file in their original (correct) form, and 50% are written to the output file in their synthetic (incorrect) form. In this way, we ensure that the grammar model sees both correct and incorrect examples during its training process. The output file takes the name of the grammar error, with the extension `ndjson`.

All output files that are used for training a spaCy model have to be added to `scripts/grammar/training_files.csv`.

To change the error that is generated by the script, update the relevant error generator on line 56 of `scripts/quillgrammar/create_grammar_training_corpus.py`

## Error generators

Errors are created by so-called error generators. These can be found in `quillnlp.grammar.generation`, `quillnlp.grammar.fragments` (for fragment generators) and `quillnlp.grammar.verb` (for verb error generators).

The general `ErrorGenerator` class is defined in `quillnlp.grammar.generation`. Crucially. it has a `generate_from_text` method, which takes a text and injects an error. All specific error generators inherit from this class.

### Simple errors

For simple errors, in which one word is confused with another, use the `TokenReplacementErrorGenerator` from `quillnlp.grammar.generation`. Upon creation, this error generator takes at least two arguments: a dictionary that describes which correct tokens should be replaced by which incorrect tokens, and the name of the grammar error. An optional third argument describes the probabilities of the replacement tokens.

For example, the following code creates an error generator that replaces instances of *than* by *then*, instances of *then* by *than*, and labels the resulting error as `than_versus_then`.

```python
generator = TokenReplacementErrorGenerator({"then": ["than"], "than": ["then"]}, GrammarError.THAN_THEN.value)
```

Similarly, the code below creates an error generator that replaces instances of *too* by *two* or *to* and labels the resulting error as `to_vs_too_vs_two_too_optimal`. The list of probabilities ensures it uses *to* as a replacement 90% of the time (because this is the more frequent error), and *two* 10% of the time.

```python
generator = TokenReplacementErrorGenerator({'too': ['two', 'to']},
                                            GrammarError.TO_TWO_TOO_TOO_OPTIMAL.value,
											probs=[0.1, 0.9])
```

### Pronoun errors

Pronoun error generators are created from the `PronounReplacementErrorGenerator`, defined in `quillnlp.grammar.generation`. This is slightly more advanced than the token replacement error generator. For example, it allows us to check the spaCy dependency role of words, in order to focus on subject/object/posessive/â€¦ pronouns. `quillnlp.grammar.generation` already has pronoun error generators for the most common pronoun errors.

### Complex errors

Other, more complex errors, have their own specific error generator, such as the `PassiveWithIncorrectBeErrorGenerator`. The `name` field of such a specific error generator specifies what grammar error they generate.